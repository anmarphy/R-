---
title: "Logistic Regression"
author: "Andrea Huerfano"
date: "September 1, 2019"
output:
  pdf_document: default
  html_document: default
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(MASS)
library(dplyr)
library(ggplot2)
library(readr)
inf<- read.delim2("C:/Users/Andrea/Downloads/cangrejos.txt")

c <- factor(inf$C)
s <- factor(inf$S)
w <- inf$W
y <- inf$Y
cangrejos <- data.frame(c,s,w,y)
```

For this model the first step is preparing the split to create two sets from the original dataset: training and testing sets, in this case we are going to use 80 percent of the sample for training the model and the other 20 percent will be used to validate de model's quality. The distribution of the observation in the two set is made over a random simple sampling applied over the index.
```{r}
# Random sample indexes
train_index <- sample(1:nrow(cangrejos), 0.8 * nrow(cangrejos))
test_index <- setdiff(1:nrow(cangrejos), train_index)

# Build X_train
X_train <- cangrejos[train_index,]
X_test <- cangrejos[test_index,]

```

For the model selection we are going to use the Step aic and the R function glm will be used to compute de logistic regression, specifying the option family = binomial, that means the response variable is binary. AIC penalizes increasing the number of parameters into de model, and the best option will be the model with the smallest.
```{r}
fit <- glm(y ~ 1 + w + c + s + c*s + c*w + s*w, family=binomial, data=X_train)
stepAIC(fit)
```

After running the aic step the best model is described below
```{r}
########### Estimación del modelo ########
fit2 <- glm(y ~ 1 + w, family=binomial, data=cangrejos)
summary(fit2)
```
The second one model has small AIC however not all the coefficient are significat at 5% level
```{r}
###################### Prueba de hipótesis ###################
fit3 <- glm(y ~ 1 + w + c, family=binomial, data=cangrejos)
summary(fit3)
anova(fit2, fit3 , test="Chisq")
```

When x=26, we would like to know the probability that the event occurs.

```{r}
###################### Estimación de una probabilidad ###################
x <- c(1,26)
eta <- sum(x*coef(fit2))
prob <- exp(eta)/(1+exp(eta))
prob
```
Now, using the function predict
```{r}
newdata <- data.frame(w = c(20,  26))
probabilities <- fit2 %>% predict(newdata, type = "response")
probabilities
```


Conidence interval for the coeficent
```{r}
alpha <- 0.05
li <- coef(fit2)[-1] - qnorm(1-alpha/2)*diag(vcov(fit2))[-1]
ls <- coef(fit2)[-1] + qnorm(1-alpha/2)*diag(vcov(fit2))[-1]
li <- exp(li)
ls <- exp(ls)
c(li,ls)
```


Predicting the value for in the testing set, for this case the threshold is 0.7, that means that if the probability is greater than 0.7 the observation will be associated with 1 and in another case will be mark with 0.
```{r}
rev<-predict(fit2,X_test,type = "response")
 X_test$predicted.classes<- ifelse(rev > 0.7, "1", "0")
X_test
```

To check the model accuracy we are going to see the percent associated with values that were classified right.
```{r}
# Model accuracy
mean(X_test$predicted.classes == X_test$y)
```
Finally to check the well know s-shape for the logistic regreesion we are going to use the ggplot library
```{r}
library(ggplot2)
X_test$rev<-predict(fit2,X_test,type = "response")


X_test %>%
  ggplot(aes(w, rev)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "glm", method.args = list(family = "binomial")) +
  labs(
    title = "Logistic Regression Model", 
    x = "Plasma Glucose Concentration",
    y = "Probability of being diabete-pos"
    )
```

```{r}
table(X_test$y,X_test$predicted.classes)
```
#References
*   R Core Team (2018). R: A language and environment for
  statistical computing. R Foundation for Statistical Computing,
  Vienna, Austria. URL https://www.R-project.org/.
  
*  H. Wickham. ggplot2: Elegant Graphics for Data Analysis.
  Springer-Verlag New York, 2016.
  
  
*  Hadley Wickham, Romain François, Lionel Henry and Kirill Müller
  (2019). dplyr: A Grammar of Data Manipulation. R package
  version 0.8.3. https://CRAN.R-project.org/package=dplyr

```{r, echo=FALSE, results=FALSE}
citation(package = "base", lib.loc = NULL)
citation(package = "ggplot2")
citation("dplyr")
```





